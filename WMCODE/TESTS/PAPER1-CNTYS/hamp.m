function trmat = hamp(c1, c2, t=1)
    ## trmat = hamp(c1, c2, t)
    ##
    ## Create a transition matrix from 2 male/female censuses using
    ## hamilton perry method.
    ##
    ## c1 and c2 must be 36 x 1 vectors, males in rows 1-18, females
    ## in 19-36, ages [0:5:85,0:5:85]'
    ##
    ## t = number of 5 year time steps between censuses
    ##
    ## cookbooked from Swanson et al 2010, with creativity in putting
    ## the fert in the matrix --
    ## http://www.ncbi.nlm.nih.gov/pmc/articles/PMC2822904/

	## reformat 
	c1 = c1(:);
	c2 = c2(:);
	if length(c1) ~= 36 || length(c2) ~= 36
	   error("%s: input matrices should be 36x1", mfilename);
	end

    ## calculate simple cohort ratios (m and f)
    crm = c2((1+t):18) ./ c1(1:(18-t));
    crf = c2((19+t):36) ./ c1(19:(36-t));    

    ## calculate fertility rows from dependency ratio
    fmat = eye(36,36);
    for ii = 1:t
        cwrm(ii) = c2(ii)/sum(c2((19+t):(24+ii)));
        cwrf(ii) = c2(18+ii)/sum(c2((19+t):24+ii));

        fmat(ii, (19+ii):(24+ii)) = cwrm(ii);
        fmat(ii+18, (19+ii):(24+ii)) = cwrf(ii);
    end;

    ## cohort move forward 2
    cmat = zeros(36, 36);
    cmat(sub2ind([36 36], (1+t):18, 1:(18-t)))  = crm;
    cmat(sub2ind([36 36], (19+t):36, 19:(36-t))) = crf;
    
    ## apply fertility after movement forward A = F*M
    trmat = fmat * cmat;

end;

## tests begin below, using Benton county.

%!shared pop,trmat1,trmat2,trmat4
%! pop = [2917    3031    5073    5054    5009    5535    5524    5788    6745
%!         3813    3438    4591    4722    5289    5798    5889    5986    6785
%!         4005    4224    4810    4400    4861    6036    6342    6565    6925
%!         3551    3844    5008    4337    4057    5247    6065    6471    6657
%!         1747    2855    4927    4099    3243    3550    4065    5468    5581
%!         2000    3269    5882    5314    4248    4271    4117    4673    6151
%!         2011    2731    5130    5182    4918    5439    4667    4690    5641
%!         1851    2331    4026    4618    4835    5849    5515    5180    5367
%!         2091    2222    3250    3559    4259    5526    5865    5860    5486
%!         2127    2193    2729    2772    3378    4981    5611    6199    6135
%!         1969    2275    2771    2546    2735    3878    4929    5974    6376
%!         1876    1893    2488    2341    2280    2816    3565    5085    5981
%!         1415    1678    1964    2162    2138    2329    2590    3504    4926
%!         887     1193    1418    1704    1876    1913    2020    2431    3368
%!         540     653     922     1144    1329    1544    1675    1794    2306
%!         337     384     474     693     929     1134    1332    1443    1583
%!         189     212     237     367     517     651     797     996     1165
%!         81      128     157     207     266     366     513     699     953 
%!         2792    2845    4714    4725    4718    5249    5266    5402    6406
%!         3728    3360    4507    4557    5035    5601    5761    5751    6390
%!         3980    4203    4560    4214    4717    5780    6041    6337    6508
%!         3373    3795    4834    4261    4058    5054    5669    6024    6285
%!         2165    2858    5063    4211    3377    3639    4116    5038    5477
%!         2254    3082    5457    5185    4467    4418    4233    4802    5911
%!         2089    2681    4805    5046    4998    5483    4746    4657    5561
%!         1940    2412    3793    4489    4836    5890    5610    5274    5308
%!         2131    2018    2947    3381    4196    5532    5924    6014    5637
%!         2218    2207    2614    2654    3243    4838    5539    6279    6344
%!         2063    2233    2632    2440    2653    3721    4681    5799    6355
%!         1767    2007    2386    2314    2322    2783    3404    4732    5918
%!         1332    1475    1970    2257    2288    2404    2630    3418    4832
%!         909     1229    1550    1840    2102    2109    2162    2558    3495
%!         582     825     1104    1434    1663    1945    2039    2040    2471
%!         423     527     724     1007    1288    1532    1853    1874    1977
%!         252     345     413     601     815     1063    1308    1470    1595
%!         178     285     372     517     640     836     1068    1451    1854];
%!    trmat1 = hamp(pop(:,1), pop(:,2), 1);
%!    trmat2 = hamp(pop(:,1), pop(:,3), 2);
%!    trmat4 = hamp(pop(:,1), pop(:,5), 4);


%!# step ahead 2  
%!assert(trmat2*pop(:,1), pop(:,3), .1);

%!# step ahead 1
%!assert(trmat1*pop(:,1), pop(:,2), .1);

%!# step ahead 4
%!assert(trmat4*pop(:,1), pop(:,5), .1);

#{
53005   1       1       2917    3031    5073    5054    5009    5535    5524    5788    6745
53005   1       2       3813    3438    4591    4722    5289    5798    5889    5986    6785
53005   1       3       4005    4224    4810    4400    4861    6036    6342    6565    6925
53005   1       4       3551    3844    5008    4337    4057    5247    6065    6471    6657
53005   1       5       1747    2855    4927    4099    3243    3550    4065    5468    5581
53005   1       6       2000    3269    5882    5314    4248    4271    4117    4673    6151
53005   1       7       2011    2731    5130    5182    4918    5439    4667    4690    5641
53005   1       8       1851    2331    4026    4618    4835    5849    5515    5180    5367
53005   1       9       2091    2222    3250    3559    4259    5526    5865    5860    5486
53005   1       10      2127    2193    2729    2772    3378    4981    5611    6199    6135
53005   1       11      1969    2275    2771    2546    2735    3878    4929    5974    6376
53005   1       12      1876    1893    2488    2341    2280    2816    3565    5085    5981
53005   1       13      1415    1678    1964    2162    2138    2329    2590    3504    4926
53005   1       14      887     1193    1418    1704    1876    1913    2020    2431    3368
53005   1       15      540     653     922     1144    1329    1544    1675    1794    2306
53005   1       16      337     384     474     693     929     1134    1332    1443    1583
53005   1       17      189     212     237     367     517     651     797     996     1165
53005   1       18      81      128     157     207     266     366     513     699     953
53005   2       1       2792    2845    4714    4725    4718    5249    5266    5402    6406
53005   2       2       3728    3360    4507    4557    5035    5601    5761    5751    6390
53005   2       3       3980    4203    4560    4214    4717    5780    6041    6337    6508
53005   2       4       3373    3795    4834    4261    4058    5054    5669    6024    6285
53005   2       5       2165    2858    5063    4211    3377    3639    4116    5038    5477
53005   2       6       2254    3082    5457    5185    4467    4418    4233    4802    5911
53005   2       7       2089    2681    4805    5046    4998    5483    4746    4657    5561
53005   2       8       1940    2412    3793    4489    4836    5890    5610    5274    5308
53005   2       9       2131    2018    2947    3381    4196    5532    5924    6014    5637
53005   2       10      2218    2207    2614    2654    3243    4838    5539    6279    6344
53005   2       11      2063    2233    2632    2440    2653    3721    4681    5799    6355
53005   2       12      1767    2007    2386    2314    2322    2783    3404    4732    5918
53005   2       13      1332    1475    1970    2257    2288    2404    2630    3418    4832
53005   2       14      909     1229    1550    1840    2102    2109    2162    2558    3495
53005   2       15      582     825     1104    1434    1663    1945    2039    2040    2471
53005   2       16      423     527     724     1007    1288    1532    1853    1874    1977
53005   2       17      252     345     413     601     815     1063    1308    1470    1595
53005   2       18      178     285     372     517     640     836     1068    1451    1854
#}
